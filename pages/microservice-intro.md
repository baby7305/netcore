# 微服务架构

## 1. 单体结构

![单体结构图](https://i.loli.net/2020/02/26/z6kwoObVxfadJIn.png)

缺点:
* 只能采用同一种技术,很难用不同的语言或者语言不同版本开发不同模块;
* 系统耦合性强,一旦其中一个模块有问题,整个系统就瘫痪了;一旦升级其中一个模块,整个系统就停机了;
* 要上线必须一起上线,互相等待,无法快速响应需求;
* 集群只能是复制整个系统,即使只是其中一个模块压力大。

随着现在 IT 系统规模的扩大、模块的剧增,传统的系统架构已经难以满足要求,因此近几年微服务架构开始流行。

## 2. 微服务

![微服务架构图](https://i.loli.net/2020/02/26/IgDY2iVhduT3xWk.jpg)

优点:
* 可以用不同的语言或者语言不同版本开发不同模块;
* 系统耦合性弱,其中一个模块有问题,可以通过“降级熔断”等手段来保证系统不雪崩;
* 可以独立上线,能够迅速响应需求;
* 可以对不同模块用不同的集群策略,哪里慢集群哪里。

缺点:
* 开发难度大,系统结构更复杂;
* 运行效率低;


不仅是阿里、腾讯等大公司在大面积使用微服务架构,很多中小公司的 IT 系统架构也是微服务架构流行了。但是不是所有项目都适合微服务,没有“银弹”。

微服务架构要处理哪些问题:服务间通讯;服务治理与服务发现;网关和安全认证;限流与容错;监控等;

第一代微服务:Dubbo(Java)、Orleans(.Net)等;和语言绑定紧密。
第二代微服务:Spring Cloud 等;适合混合开发,正当年。
第三代微服务:Service Mesh(Service Fabric、Istio、Conduit 等)。目前还在快速发展中,更新迭代比较快。

## 3. 微服务选型
Spring Cloud 是使用 Java 开发的,使用 Java 在 Spring Cloud 下开发最爽,使用[steelto](https://steeltoe.io/) 这个开发包也是可以使用.Net Core 开发 Spring Cloud 下的微服务,但 是开发体验没有 Java 那么效率高,而且支持的软件版本更新没有 Java 那么快,使用 Zuul 等 的时候还可能需要写一些 Java 代码。

因此,如果整个项目的技术栈是 Spring Cloud 的,那么.Net Core 开发者可以借助于 steelto “寄居”。如果自己有技术栈的选择权,那么可以自己搭建更亲近.Net Core 的微服务框架。

Service Fabric 是微软开源的微软内部使用的第三代微服务框架,可以使用.Net Core 开发, 也可以使用 Java 开发。但是目前开源的版本还不太适合普通厂商使用(难度;跨平台;通 用性;支持私有云,但是难度大),慎用。愿意花钱在 Azure 云上用 SF,可以用。但是如果 想搭建 SF 私有云,慎用。

如果选择.Net Core 技术栈的第二代微服务框架,推荐使用腾讯(微信支付清算网关)在 使用架构:Consul + Ocelot + .Net Core+Polly + ...

在微服务中,服务之间的通讯有两种主要形式:
* Restful,也就是传输 Json 格式数据。.Net 中就是对应 WebAPI 技术,不精通 WebAPI 也没关系,和 ASP.Net MVC 差不多,可以使用 PostMan 方便的调试 Restful 接口。
* 二进制 RPC:二进制传输协议,比 Restful 用的 Http 通讯效率更高,但是耦合性更强。技术有 Thrift、gRPC 等。
