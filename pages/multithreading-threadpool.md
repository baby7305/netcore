# 线程池
## 1 线程池简介
* 系统中创建一个线程就会开辟一个至少 1M 的内存空间
* 线程还可能会占用部分寄存器
* 线程非常多的时候,OS需要花费大量的时间在不同的线程之间进行切换。

我们可以通过线程池对以上问题进行优化。线程池是一组已经创建好的线程,随用随取,用完了不是销毁线程,然后放到线程池中,供其他人用。当需要创建大量线程时,我们推荐使用线程池技术。

系统同时处理的线程的个数与系统的硬件资源有关,线程数量与系统运行效率大概呈正态分布。在达到最高值之后,线程数量再增加 OS 将花费大量的时间和资源来切换线程,执行效率反而会下降。

## 2. 线程池特点
### 2.1 线程池特点

* 线程池线程本身默认都是后台线程，不需要手动启动
* 线程池中的线程可以进行重用，线程使用完成后不会马上释放而是进入线程池等待重用
* 当程序中需要创建大量线程执行小数据量操作时，线程池可以大幅调高线程执行效率。
* 使用线程池操作线程的灵活性较差，我们无法获取线程池中的线程信息，所以无法干预线程池中的线程
* 虽然工作项进入线程池队列的时候保证了先进先出，但是各个工作线程获取工作项放到本地的队列后是使用的先进后出的方式，所以不能保证整体的请求项之间是请求处理的顺序。
* 线程池有最大线程数，最小线程数和默认线程数。ThreadPool.GetMaxThreads()获取线程池的最大线程数和当前线程池大小，线程池大小会根据CPU自动计算获得，不推荐手动修改。ThreadPool.GetMinThreads()，获取线程池最小线程数
* 线程池提高了线程的利用率，非常**适合工作任务非常小，而且又需要使用单独的线程来解决的问题**。

### 2.2 手动创建线程与线程池对比

* 能用线程池的就用线程池，但线程池处理顺序不确定
* 线程池的优势在于线程执行大量小运算
* 要手动干预线程的话必须手动创建线程
* 要设置线程的优先级时，必须手动创建线程
* 线程执行时间较长是，两种方式差异不大

### 2.3 使用方式
```csharp
//有参
ThreadPool.QueueUserWorkItem((s) => Console.WriteLine(s),"Hello");

//参数
ThreadPool.QueueUserWorkItem(s => Console.WriteLine("Hello"));
```